import{K as b,L as K,M as G,N as A,O as q,Q as X,R as Y,S as J,T as Q,U as Z,V as ee,W as N,X as te,Y as ne,Z as B,e as y,h as se,m as U,$ as L,a0 as ie,a1 as $,a2 as P,a3 as oe,a4 as re,G as p,a5 as _,a6 as ae,a7 as F,a8 as I,z as j,B as O,A as D,d as w,a9 as ce,E,v as ue,aa as le,o as fe,c as he,H as k,ab as de,ac as me,J as W,ad as ve}from"../app.e23ab445.js";function T(){return m(b)}function pe(){const n=m(b).getSceneRef();if(!n)throw new Error("\u5BB9\u5668\u5143\u7D20\u7F3A\u5931");return n}function ze(){const n=m(b).getRenderer();if(!n)throw new Error("\u6E32\u67D3\u5668\u7F3A\u5931");return n}function Ge(){const n=m(b).getRenderCamera();if(!n)throw new Error("\u76F8\u673A\u7F3A\u5931");return n}function Me(){return m(b).getScene()}function H(){return m(K)}function qe(){return m(G)}function Se(){return m(A)}function Xe(){return m(q,null)}function Ye(){return m(X)}function Je(){return m(Y)}function Qe(){return m(J)}function Ze(){return m(Q)}function et(){return m(Z)}function tt(){return m(ee)}function nt(){return m(N)}function st(){return m(te)}function it(){return m(ne)}function m(n,e=void 0){const t=B(n,e);return!t&&e!==null&&console.warn(`injection ${String(n)} not found`),t}const V="ft",Oe="is-",C=(n,e,t,s,c)=>{let r=`${n}-${e}`;return t&&(r+=`-${t}`),s&&(r+=`__${s}`),c&&(r+=`--${c}`),r},ge=Symbol("namespaceContextKey"),Re=n=>{const e=n||B(ge,y(V));return se(()=>U(e)||V)},Ce=(n,e)=>{const t=Re(e);return{namespace:t,b:(i="")=>C(t.value,n,i,"",""),e:i=>i?C(t.value,n,"",i,""):"",m:i=>i?C(t.value,n,"","",i):"",be:(i,h)=>i&&h?C(t.value,n,i,h,""):"",em:(i,h)=>i&&h?C(t.value,n,"",i,h):"",bm:(i,h)=>i&&h?C(t.value,n,i,"",h):"",bem:(i,h,S)=>i&&h&&S?C(t.value,n,i,h,S):"",is:(i,...h)=>{const S=h.length>=1?h[0]:!0;return i&&S?`${Oe}${i}`:""},cssVar:i=>{const h={};for(const S in i)i[S]&&(h[`--${t.value}-${S}`]=i[S]);return h},cssVarName:i=>`--${t.value}-${i}`,cssVarBlock:i=>{const h={};for(const S in i)i[S]&&(h[`--${t.value}-${n}-${S}`]=i[S]);return h},cssVarBlockName:i=>`--${t.value}-${n}-${i}`}};class be{constructor(e,t){this.renderCamera=L(),this.renderer=L(),this.scene=e,this.sceneRef=t}setRenderer(e){this.renderer.value=e}getRenderer(){return this.renderer.value}setRenderCamera(e){this.renderCamera.value=e}setSceneRef(e){this.sceneRef.value=e}getRenderCamera(){return this.renderCamera.value}getSceneRef(){return this.sceneRef.value}getScene(){return this.scene}}class ye{constructor(e="id"){this.keyStr=e,this.aollections=ie([])}clearCount(){this.aollections.length=0}addCount(e){this.aollections.push(e)}subCount(e){const t=this.aollections.findIndex(s=>s[this.keyStr]===e[this.keyStr]);t>-1&&this.aollections.splice(t,1)}}class Ee{constructor(){this._animationFunMap=new Map,this._noRender=!1}get noRender(){return this._noRender}set noRender(e){this._noRender=e}on(e,t){this._animationFunMap.set(e,t)}off(e){this._animationFunMap.has(e)?this._animationFunMap.delete(e):console.warn(`AnimationService off(): ${e} not found`)}emit(e){this._animationFunMap.forEach(t=>{t(e)})}destory(){this._animationFunMap.clear()}getAnimationFunMap(){return this._animationFunMap}}var R=(n=>(n.MOUSEMOVE="MOUSEMOVE",n.CLICK="CLICK",n.MOUSEMOVEPOSITION="MOUSEMOVEPOSITION",n))(R||{});class we{constructor(){this._subscriber=[]}on(e){this._subscriber.push(e)}emit(...e){this._subscriber.forEach(t=>{t(...e)})}off(e){const t=this._subscriber.indexOf(e);t>-1&&this._subscriber.splice(t,1)}clear(){this._subscriber=[]}get subscriber(){return this._subscriber}}class x{constructor(e,t){this.sub=new we,this.sceneRef=y(),this.pointer=new $(1e7,1e7),this.position=new P(0,0,0),this.plane=new oe(new P(0,0,1),0),this.options=t,this.scene=e,this.raycaster=new re(t.origin,t.direction,t.near,t.far)}setSceneRef(e){this.sceneRef=e}setCamera(e){this.camera=e}setRaycasterOptions(e){const t=e||{},s=this.raycaster;t.origin&&t.direction&&s.set(t.origin,t.direction),t.near&&(s.near=t.near),t.far&&(s.far=t.far)}genMiddleFn(e,t,s){return c=>{const r=this.raycaster,u=this.genIntersects(r,c.camera,Array.isArray(t)?t:[t],this.pointer,s);this.executeCallback(e,c,u,s)}}executeCallback(e,t,s,c){(s.length||(c==null?void 0:c.allTheTime))&&e({...t,targets:s})}on(e,t,s){var u;this.sub.subscriber.length===0&&this.addListeners(),this.setRaycasterOptions(s);const c=this.genMiddleFn(e,t,s),r=p.exports.throttle(c,(u=s==null?void 0:s.wait)!=null?u:50);this.sub.on(r)}emit(e){this.sub.emit(e)}off(e){this.sub.off(e)}updatePosition(e){if(!e||!this.camera)return;const t=new $(this.pointer.x,this.pointer.y);e.setFromCamera(t,this.camera),this.camera.getWorldDirection(this.plane.normal),e.ray.intersectPlane(this.plane,this.position)}genIntersects(e,t,s,c,r){var l;e.setFromCamera(c,t);const u=(l=r==null?void 0:r.recursive)!=null?l:!1;return e.intersectObjects(s,u,r==null?void 0:r.optionalTarget)}addListeners(){this.sceneRef.value.addEventListener("mousemove",this.hanlder.bind(this),!1)}removeListeners(){this.sceneRef.value.removeEventListener("mousemove",this.hanlder,!1)}hanlder(e){const t=this.sceneRef.value;this.pointer.x=e.offsetX/t.offsetWidth*2-1,this.pointer.y=-(e.offsetY/t.offsetHeight)*2+1,this.emit({scene:this.scene,camera:this.camera,targets:[],position:this.position})}destroy(){this.removeListeners(),this.sub.clear()}}class Fe extends x{executeCallback(e,t,s){e({...t,targets:s})}}class Ie extends x{addListeners(){this.sceneRef.value.addEventListener("pointerup",this.hanlder.bind(this),!1)}removeListeners(){this.sceneRef.value.removeEventListener("pointerup",this.hanlder,!1)}}class _e extends x{genMiddleFn(e){return t=>{const s=this.raycaster;this.updatePosition(s),e({targets:[],camera:t.camera,scene:t.scene,position:this.position})}}}class je{constructor(e,t){this.sceneRef=y(),this.instanceMap=new Map,this.scene=e,this.options=t,this.instanceMap.set(R.MOUSEMOVE,new Fe(e,t)),this.instanceMap.set(R.CLICK,new Ie(e,t)),this.instanceMap.set(R.MOUSEMOVEPOSITION,new _e(e,t))}setSceneRef(e){this.instanceMap.forEach(t=>{t.setSceneRef(e)})}setCamera(e){this.instanceMap.forEach(t=>{t.setCamera(e)})}on(e,t,s,c){var r;(r=this.instanceMap.get(e))==null||r.on(t,s,c)}off(e,t){var s;(s=this.instanceMap.get(e))==null||s.off(t)}destory(){this.instanceMap.forEach(e=>{e.destroy()})}}function ot(n,e){const t=T();_(()=>n.isRenderCamera,s=>{s&&t.setRenderCamera(e)},{immediate:!0})}function z(n,e,t,s){let c;function r(l,d=[]){if(p.exports.isObject(l)&&!F(l)&&!p.exports.isFunction(l))for(const o of Object.keys(l)){const a=l[o],f=[...d];f.push(o),r(a,f)}else d.reduce((o,a,f)=>{if(f===d.length-1)if(p.exports.isFunction(o.instance[a]))if(F(o.options[a]))o.instance[a](...o.options[a]);else if(p.exports.isFunction(o.options[a])){const v=o.options[a](t,e);F(v)?o.instance[a](...v):o.instance[a](v)}else o.instance[a](o.options[a]);else p.exports.isFunction(o.options[a])?o.instance[a]=o.options[a](t,e):o.instance[a]=o.options[a];return{instance:o.instance[a],options:o.options[a]}},{instance:e,options:n})}return{watchStopHandle:_(()=>n,l=>{const d=ae(l);let o=d;c&&(o=xe(o,c)),r(o),s&&s(e),c=p.exports.cloneDeep(d)},{immediate:!0,deep:!0})}}function xe(n,e){function t(s,c){return p.exports.transform(s,(r,u,l)=>{p.exports.isEqual(u,c[l])||(r[l]=p.exports.isObject(u)&&!p.exports.isFunction(u)&&p.exports.isObject(c[l])&&!p.exports.isFunction(u)?t(u,c[l]):u)})}return t(n,e)}const Le={onMouseMove:{type:O(Function)},onClick:{type:O(Function)},onMouseMovePosition:{type:O(Function)},clickOptions:{type:O(Object),default:()=>({})},mouseMoveOptions:{type:O(Object),default:()=>({})},onMouseMovePositionOptions:{type:O(Object),default:()=>({})},cursor:{type:String}},$e={mouseMove:n=>n,click:n=>n,onMouseMovePosition:n=>n};function Pe(n,e,t,s,c,r,u,l){const d=h=>e("mouseMove",h),o=h=>e("click",h),a=h=>e("mouseMovePosition",h),f=c?I(d,c):d,v=r?I(o,r):o,g=u?I(u,a):a,M=s||H();(n.onMouseMove||c)&&M.on(R.MOUSEMOVE,f,t,n.mouseMoveOptions),(n.onClick||r)&&M.on(R.CLICK,v,t,n.clickOptions),(n.onMouseMovePosition||u)&&M.on(R.MOUSEMOVEPOSITION,g,t,n.onMouseMovePositionOptions),l||j(()=>{i()});function i(){n.onMouseMove&&M.off(R.MOUSEMOVE,f),n.onClick&&M.off(R.CLICK,v),n.onMouseMovePosition&&M.off(R.MOUSEMOVEPOSITION,g)}return{dispose:i}}const Ve={load:n=>n,...$e},Ke=D({options:{type:O(Object),default:()=>({})},eventOptions:{type:O(Object),default:()=>({})},...Le}),Ae=w({name:"FtScene"}),Ne=w({...Ae,props:Ke,emits:Ve,setup(n,{expose:e,emit:t}){const s=n,c=t,r=y(!1),u=Ce("scene"),l=y(),d=new ce;let o=new ye,a=new be(d,l),f=new je(d,s.eventOptions),v=new Ee;return c("load",{scene:d}),E(N,o),E(b,a),E(K,f),E(A,v),z(s.options,d,d),ue(()=>{f.setSceneRef(l),Pe(s,c,d.children,f),r.value=!0}),j(()=>{var g;(g=l.value)==null||g.remove(),d.clear(),f.destory(),o.clearCount(),v=null,f=null,o=null,a=null}),e({scene:d}),console.log("\u5F53\u524Dthreejs\u7248\u672C\u53F7:",le),(g,M)=>(fe(),he("div",{ref_key:"sceneRef",ref:l,class:me([U(u).b()])},[r.value?k(g.$slots,"default",{key:0}):de("",!0)],2))}});var Be=Ne;const rt=W(Be),Ue=D({animationFn:{type:O(Function)},params:{type:O(Object),default:()=>({antialias:!0,logarithmicDepthBuffer:!0})},options:{type:O(Object),default:()=>({shadowMap:{enabled:!0}})}}),De={load:n=>n},ke=w({name:"FtWebglRenderer"}),We=w({...ke,props:Ue,emits:De,setup(n,{expose:e,emit:t}){const s=n,c=t;let r=Me(),u=pe(),l=T(),d=H(),o=Se(),a=l.getRenderCamera();if(_(()=>l.renderCamera.value,i=>{i&&(a=i,d.setCamera(a))},{immediate:!0}),!a)throw new Error("<webgl-renderer /> \u6CA1\u6709\u627E\u5230\u4E3B\u6E32\u67D3\u76F8\u673A!");const f=new ve(s.params);l.setRenderer(f),f.setSize(u.offsetWidth,u.offsetHeight),u.appendChild(f.domElement),s.animationFn&&o.on("propsFn",s.animationFn);function v(){a&&(o.emit({renderer:f,scene:r,camera:a}),o.noRender||f.render(r,a)),requestAnimationFrame(v)}v();const g=()=>{f.setSize(u.offsetWidth,u.offsetHeight)},M=new ResizeObserver(g);return M.observe(u),c("load",{renderer:f,scene:r,camera:a}),z(s.options,f,r),j(()=>{s.animationFn&&o.off("propsFn"),M.unobserve(u),M.disconnect(),u.removeChild(f.domElement),f.forceContextLoss(),f.dispose(),r=null,u=null,l=null,d=null,o=null,a=null}),e({renderer:f}),(i,h)=>k(i.$slots,"default")}});var Te=We;const at=W(Te);export{ye as C,at as F,rt as a,Me as b,ot as c,z as d,$e as e,Le as f,Xe as g,nt as h,Pe as i,qe as j,Je as k,T as l,ze as m,Se as n,Ye as o,Qe as p,it as q,Ge as r,Ze as s,et as t,pe as u,tt as v,st as w};
