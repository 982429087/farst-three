import{aw as _,ax as W,aq as Y,ay as k,az as X,at as Q,ar as Z,aA as z,aB as H,e as g,h as ee,m as T,J as K,aC as te,aD as B,V as D,aE as se,R as ne,aF as h,ap as F,aG as oe,aH as P,aI as V,ac as w,ae as v,ad as I,d as E,aJ as ie,aj as R,ag as $,aK as re,ah as x,aL as ae,aa as ce,aM as ue,o as le,c as fe,Y as de,aN as me,aO as he,aP as pe}from"../app.b6b87ec6.js";function N(){return C(_)}function G(){const s=C(_).getSceneRef();if(!s)throw new Error("\u5BB9\u5668\u5143\u7D20\u7F3A\u5931");return s}function ve(){const s=C(_).getRenderer();if(!s)throw new Error("\u6E32\u67D3\u5668\u7F3A\u5931");return s}function L(){return C(_).getScene()}function q(){return C(W)}function tt(){return C(Y)}function J(){return C(k)}function st(){return C(X,null)}function nt(){return C(Q)}function ot(){return C(Z)}function it(){return C(z)}function C(s,e=void 0){const t=H(s,e);return!t&&e!==null&&console.warn(`injection ${String(s)} not found`),t}const U="ft",Me="is-",y=(s,e,t,n,a)=>{let i=`${s}-${e}`;return t&&(i+=`-${t}`),n&&(i+=`__${n}`),a&&(i+=`--${a}`),i},be=Symbol("namespaceContextKey"),Ce=s=>{const e=s||H(be,g(U));return ee(()=>T(e)||U)},Oe=(s,e)=>{const t=Ce(e);return{namespace:t,b:(u="")=>y(t.value,s,u,"",""),e:u=>u?y(t.value,s,"",u,""):"",m:u=>u?y(t.value,s,"","",u):"",be:(u,m)=>u&&m?y(t.value,s,u,m,""):"",em:(u,m)=>u&&m?y(t.value,s,"",u,m):"",bm:(u,m)=>u&&m?y(t.value,s,u,"",m):"",bem:(u,m,b)=>u&&m&&b?y(t.value,s,u,m,b):"",is:(u,...m)=>{const b=m.length>=1?m[0]:!0;return u&&b?`${Me}${u}`:""},cssVar:u=>{const m={};for(const b in u)u[b]&&(m[`--${t.value}-${b}`]=u[b]);return m},cssVarName:u=>`--${t.value}-${u}`,cssVarBlock:u=>{const m={};for(const b in u)u[b]&&(m[`--${t.value}-${s}-${b}`]=u[b]);return m},cssVarBlockName:u=>`--${t.value}-${s}-${u}`}};class Se{constructor(e,t){this.renderCamera=K(),this.renderer=K(),this.scene=e,this.sceneRef=t}setRenderer(e){this.renderer.value=e}getRenderer(){return this.renderer.value}setRenderCamera(e){this.renderCamera.value=e}setSceneRef(e){this.sceneRef.value=e}getRenderCamera(){return this.renderCamera.value}getSceneRef(){return this.sceneRef.value}getScene(){return this.scene}}class Ee{constructor(e="id"){this.keyStr=e,this.aollections=te([])}clearCount(){this.aollections.length=0}addCount(e){this.aollections.push(e)}subCount(e){const t=this.aollections.findIndex(n=>n[this.keyStr]===e[this.keyStr]);t>-1&&this.aollections.splice(t,1)}}class ye{constructor(){this._animationFunMap=new Map,this._noRender=!1}get noRender(){return this._noRender}set noRender(e){this._noRender=e}on(e,t){this._animationFunMap.set(e,t)}off(e){this._animationFunMap.has(e)?this._animationFunMap.delete(e):console.warn(`AnimationService off(): ${e} not found`)}emit(e){this._animationFunMap.forEach(t=>{t(e)})}destory(){this._animationFunMap.clear()}getAnimationFunMap(){return this._animationFunMap}}var S=(s=>(s.MOUSEMOVE="MOUSEMOVE",s.CLICK="CLICK",s.MOUSEMOVEPOSITION="MOUSEMOVEPOSITION",s))(S||{});class Re{constructor(){this._subscriber=[]}on(e){this._subscriber.push(e)}emit(...e){this._subscriber.forEach(t=>{t(...e)})}off(e){const t=this._subscriber.indexOf(e);t>-1&&this._subscriber.splice(t,1)}clear(){this._subscriber=[]}get subscriber(){return this._subscriber}}class A{constructor(e,t){this.sub=new Re,this.sceneRef=g(),this.pointer=new B(1e7,1e7),this.position=new D(0,0,0),this.plane=new se(new D(0,0,1),0),this.options=t,this.scene=e,this.raycaster=new ne(t.origin,t.direction,t.near,t.far)}setSceneRef(e){this.sceneRef=e}setCamera(e){this.camera=e}setRaycasterOptions(e){const t=e||{},n=this.raycaster;t.origin&&t.direction&&n.set(t.origin,t.direction),t.near&&(n.near=t.near),t.far&&(n.far=t.far)}genMiddleFn(e,t,n){return a=>{const i=this.raycaster,r=this.genIntersects(i,a.camera,Array.isArray(t)?t:[t],this.pointer,n);this.executeCallback(e,a,r,n)}}executeCallback(e,t,n,a){(n.length||(a==null?void 0:a.allTheTime))&&e({...t,targets:n})}on(e,t,n){var r;this.sub.subscriber.length===0&&this.addListeners(),this.setRaycasterOptions(n);const a=this.genMiddleFn(e,t,n),i=h.exports.throttle(a,(r=n==null?void 0:n.wait)!=null?r:50);this.sub.on(i)}emit(e){this.sub.emit(e)}off(e){this.sub.off(e)}updatePosition(e){if(!e||!this.camera)return;const t=new B(this.pointer.x,this.pointer.y);e.setFromCamera(t,this.camera),this.camera.getWorldDirection(this.plane.normal),e.ray.intersectPlane(this.plane,this.position)}genIntersects(e,t,n,a,i){var l;e.setFromCamera(a,t);const r=(l=i==null?void 0:i.recursive)!=null?l:!1;return e.intersectObjects(n,r,i==null?void 0:i.optionalTarget)}addListeners(){this.sceneRef.value.addEventListener("mousemove",this.hanlder.bind(this),!1)}removeListeners(){this.sceneRef.value.removeEventListener("mousemove",this.hanlder,!1)}hanlder(e){const t=this.sceneRef.value;this.pointer.x=e.offsetX/t.offsetWidth*2-1,this.pointer.y=-(e.offsetY/t.offsetHeight)*2+1,this.emit({scene:this.scene,camera:this.camera,targets:[],position:this.position})}destroy(){this.removeListeners(),this.sub.clear()}}class ge extends A{executeCallback(e,t,n){e({...t,targets:n})}}class _e extends A{addListeners(){this.sceneRef.value.addEventListener("pointerup",this.hanlder.bind(this),!1)}removeListeners(){this.sceneRef.value.removeEventListener("pointerup",this.hanlder,!1)}}class we extends A{genMiddleFn(e){return t=>{const n=this.raycaster;this.updatePosition(n),e({targets:[],camera:t.camera,scene:t.scene,position:this.position})}}}class Fe{constructor(e,t){this.sceneRef=g(),this.instanceMap=new Map,this.scene=e,this.options=t,this.instanceMap.set(S.MOUSEMOVE,new ge(e,t)),this.instanceMap.set(S.CLICK,new _e(e,t)),this.instanceMap.set(S.MOUSEMOVEPOSITION,new we(e,t))}setSceneRef(e){this.instanceMap.forEach(t=>{t.setSceneRef(e)})}setCamera(e){this.instanceMap.forEach(t=>{t.setCamera(e)})}on(e,t,n,a){var i;(i=this.instanceMap.get(e))==null||i.on(t,n,a)}off(e,t){var n;(n=this.instanceMap.get(e))==null||n.off(t)}destory(){this.instanceMap.forEach(e=>{e.destroy()})}}function Ie(s,e){const t=N();F(()=>s.isRenderCamera,n=>{n&&t.setRenderCamera(e)},{immediate:!0})}function j(s,e,t,n){let a;function i(l,f=[]){if(h.exports.isObject(l)&&!P(l)&&!h.exports.isFunction(l))for(const o of Object.keys(l)){const c=l[o],d=[...f];d.push(o),i(c,d)}else f.reduce((o,c,d)=>{if(d===f.length-1)if(h.exports.isFunction(o.instance[c]))if(P(o.options[c]))o.instance[c](...o.options[c]);else if(h.exports.isFunction(o.options[c])){const p=o.options[c](t,e);P(p)?o.instance[c](...p):o.instance[c](p)}else o.instance[c](o.options[c]);else h.exports.isFunction(o.options[c])?o.instance[c]=o.options[c](t,e):o.instance[c]=o.options[c];return{instance:o.instance[c],options:o.options[c]}},{instance:e,options:s})}return{watchStopHandle:F(()=>s,l=>{const f=oe(l);let o=f;a&&(o=$e(o,a)),i(o),n&&n(e),a=h.exports.cloneDeep(f)},{immediate:!0,deep:!0})}}function $e(s,e){function t(n,a){return h.exports.transform(n,(i,r,l)=>{h.exports.isEqual(r,a[l])||(i[l]=h.exports.isObject(r)&&!h.exports.isFunction(r)&&h.exports.isObject(a[l])&&!h.exports.isFunction(r)?t(r,a[l]):r)})}return t(s,e)}const xe={onMouseMove:{type:v(Function)},onClick:{type:v(Function)},onMouseMovePosition:{type:v(Function)},clickOptions:{type:v(Object),default:()=>({})},mouseMoveOptions:{type:v(Object),default:()=>({})},onMouseMovePositionOptions:{type:v(Object),default:()=>({})},cursor:{type:String}},je={mouseMove:s=>s,click:s=>s,onMouseMovePosition:s=>s};function Pe(s,e,t,n,a,i,r,l){const f=m=>e("mouseMove",m),o=m=>e("click",m),c=m=>e("mouseMovePosition",m),d=a?V(f,a):f,p=i?V(o,i):o,O=r?V(r,c):c,M=n||q();(s.onMouseMove||a)&&M.on(S.MOUSEMOVE,d,t,s.mouseMoveOptions),(s.onClick||i)&&M.on(S.CLICK,p,t,s.clickOptions),(s.onMouseMovePosition||r)&&M.on(S.MOUSEMOVEPOSITION,O,t,s.onMouseMovePositionOptions),l||w(()=>{u()});function u(){s.onMouseMove&&M.off(S.MOUSEMOVE,d),s.onClick&&M.off(S.CLICK,p),s.onMouseMovePosition&&M.off(S.MOUSEMOVEPOSITION,O)}return{dispose:u}}const Ve=I({fov:{type:Number,default:75},aspect:{type:Number},near:{type:Number,default:.01},far:{type:Number,default:2e3},isRenderCamera:{type:Boolean,default:!0},options:{type:v(Object),default:()=>({})}}),Ne={load:s=>s},Le=E({name:"FtPerspectiveCamera"}),Ae=E({...Le,props:Ve,emits:Ne,setup(s,{emit:e}){const t=s,n=e;let a=G(),i=L(),r=new ie(t.fov,t.aspect||a.offsetWidth/a.offsetHeight,t.near,t.far);i.add(r),n("load",{camera:r,scene:i}),Ie(t,r),R(re,r);const l=()=>{r.aspect=a.offsetWidth/a.offsetHeight,r.updateProjectionMatrix()},f=h.exports.debounce(()=>l(),5),o=new ResizeObserver(f);return o.observe(a),j(t.options,r,i),w(()=>{i.remove(r),o.unobserve(a),i=null,a=null,r=null}),(c,d)=>$(c.$slots,"default")}});var Ke=Ae;const rt=x(Ke),Be={load:s=>s,...je},De=I({options:{type:v(Object),default:()=>({})},eventOptions:{type:v(Object),default:()=>({})},...xe}),Ue=E({name:"FtScene"}),We=E({...Ue,props:De,emits:Be,setup(s,{expose:e,emit:t}){const n=s,a=t,i=g(!1),r=Oe("scene"),l=g(),f=new ae;let o=new Ee,c=new Se(f,l),d=new Fe(f,n.eventOptions),p=new ye;return a("load",{scene:f}),R(z,o),R(_,c),R(W,d),R(k,p),j(n.options,f,f),ce(()=>{d.setSceneRef(l),Pe(n,a,f.children,d),i.value=!0}),w(()=>{var O;(O=l.value)==null||O.remove(),f.clear(),d.destory(),o.clearCount(),p=null,d=null,o=null,c=null}),e({scene:f}),console.log("\u5F53\u524Dthreejs\u7248\u672C\u53F7:",ue),(O,M)=>(le(),fe("div",{ref_key:"sceneRef",ref:l,class:me([T(r).b()])},[i.value?$(O.$slots,"default",{key:0}):de("",!0)],2))}});var ke=We;const at=x(ke),ze=I({animationFn:{type:v(Function)},params:{type:v(Object),default:()=>({antialias:!0,logarithmicDepthBuffer:!0})},options:{type:v(Object),default:()=>({shadowMap:{enabled:!0}})}}),He={load:s=>s},Te=E({name:"FtWebglRenderer"}),Ge=E({...Te,props:ze,emits:He,setup(s,{expose:e,emit:t}){const n=s,a=t;let i=L(),r=G(),l=N(),f=q(),o=J(),c=l.getRenderCamera();if(F(()=>l.renderCamera.value,u=>{u&&(c=u,f.setCamera(c))},{immediate:!0}),!c)throw new Error("<webgl-renderer /> \u6CA1\u6709\u627E\u5230\u4E3B\u6E32\u67D3\u76F8\u673A!");const d=new he(n.params);l.setRenderer(d),d.setSize(r.offsetWidth,r.offsetHeight),r.appendChild(d.domElement),n.animationFn&&o.on("propsFn",n.animationFn);function p(){c&&(o.emit({renderer:d,scene:i,camera:c}),o.noRender||d.render(i,c)),requestAnimationFrame(p)}p();const O=()=>{d.setSize(r.offsetWidth,r.offsetHeight)},M=new ResizeObserver(O);return M.observe(r),a("load",{renderer:d,scene:i,camera:c}),j(n.options,d,i),w(()=>{n.animationFn&&o.off("propsFn"),M.unobserve(r),M.disconnect(),r.removeChild(d.domElement),d.forceContextLoss(),d.dispose(),i=null,r=null,l=null,f=null,o=null,c=null}),e({renderer:d}),(u,m)=>$(u.$slots,"default")}});var qe=Ge;const ct=x(qe),Je=I({modelValue:{type:Object},options:{type:v(Object),default:()=>({})}}),Ye={load:s=>s},Xe=E({name:"FtOrbitControls"}),Qe=E({...Xe,props:Je,emits:Ye,setup(s,{emit:e}){const t=s,n=e,a=L(),i=N(),r=ve(),l=J();let f=i.getRenderCamera(),o;return F(()=>i.renderCamera.value,c=>{if(c&&(f=c),!f)throw new Error("<OrbitControls /> \u6CA1\u6709\u627E\u5230\u4E3B\u6E32\u67D3\u76F8\u673A!");o=new pe(f,r.domElement),n("load",{controls:o,camera:f,renderer:r}),j(t.options,o,a)},{immediate:!0}),l.on("controls",()=>{o==null||o.update()}),w(()=>{o==null||o.dispose(),l.off("controls")}),(c,d)=>$(c.$slots,"default")}});var Ze=Qe;const ut=x(Ze);export{Ee as C,rt as F,j as a,tt as b,xe as c,st as d,je as e,it as f,Pe as g,ot as h,ct as i,ut as j,at as k,nt as l,L as u};
